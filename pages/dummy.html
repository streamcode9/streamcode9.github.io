---
layout: page
title: Dummy Page
permalink: /dummy/
---
<section class="dummy-page">
  <h2>Dummy Content</h2>
  <p>This is a placeholder page created for testing purposes. Feel free to update this content with real information later.</p>
  <ul>
    <li>Item one</li>
    <li>Item two</li>
    <li>Item three</li>
  </ul>
  <blockquote>
    <p>"Sometimes you just need a blank canvas before the masterpiece arrives."</p>
  </blockquote>
</section>

<section class="dummy-page">
  <h2>WebAssembly Greeting Demo</h2>
  <p>
    The button below loads <code>wasm/hello.wasm</code>—a module compiled from <code>hello.c</code>—
    and calls the exported <code>get_greeting</code> function to display its message.
  </p>
  <button type="button" id="load-wasm">Load greeting from WebAssembly</button>
  <pre id="wasm-result" aria-live="polite">Click the button to fetch the WebAssembly module.</pre>
</section>

<script type="module">
const wasmPath = 'wasm/hello.wasm'; // relative (works on GitHub Pages subpaths)
const loadButton = document.getElementById('load-wasm');
const output = document.getElementById('wasm-result');
const utf8 = new TextDecoder();

if (!loadButton || !output) {
  console.error('Missing #load-wasm button or #wasm-result element in the DOM.');
}

async function instantiateWasm(url, imports = {}) {
  // Try streaming first (faster if server sets application/wasm)
  try {
    const res = await fetch(url);
    if (!res.ok) throw new Error(`HTTP ${res.status} ${res.statusText}`);
    try {
      return await WebAssembly.instantiateStreaming(res, imports);
    } catch {
      // Fallback if wrong MIME
      const bytes = await res.arrayBuffer();
      return await WebAssembly.instantiate(bytes, imports);
    }
  } catch (e) {
    throw new Error(`Failed to fetch/instantiate WASM: ${e.message}`);
  }
}

async function loadGreetingFromWasm() {
  if (output) output.textContent = 'Loading greeting...';

  try {
    // No imports needed for your module, but keep an empty object for clarity
    const { instance } = await instantiateWasm(new URL(wasmPath, document.baseURI));
    const { exports } = instance;

    const getGreeting = exports.get_greeting || exports._get_greeting;
    const getGreetingLength = exports.get_greeting_length || exports._get_greeting_length;

    if (typeof getGreeting !== 'function' || typeof getGreetingLength !== 'function') {
      throw new Error('Expected WebAssembly exports "get_greeting" and "get_greeting_length" not found.');
    }

    // Some toolchains expose an optional initializer (not needed here, but harmless)
    if (typeof exports._initialize === 'function') {
      exports._initialize();
    }

    const memory = exports.memory;
    if (!(memory instanceof WebAssembly.Memory)) {
      throw new Error('WebAssembly memory export is missing.');
    }

    const ptr = getGreeting();
    const len = getGreetingLength();

    const bytes = new Uint8Array(memory.buffer, ptr, len);
    const greeting = utf8.decode(bytes);

    if (output) output.textContent = greeting;
  } catch (error) {
    console.error(error);
    if (output) output.textContent = `Failed to load greeting: ${error.message}`;
  }
}

loadButton?.addEventListener('click', loadGreetingFromWasm);
</script>
